version: "3.8"

services:
  # postgres:
  #   image: postgres:15
  #   container_name: esp32_postgres
  #   restart: always
  #   environment:
  #     POSTGRES_USER: espuser
  #     POSTGRES_PASSWORD: esp123
  #     POSTGRES_DB: esp32db
  #   ports:
  #     - "5434:5432"
  #   volumes:
  #     - pgdata:/var/lib/postgresql/data
  #     - ./backend/sql/init.sql:/docker-entrypoint-initdb.d/init.sql
  #     - ./backend/sql/DK4.csv:/docker-entrypoint-initdb.d/DK4.csv
  #     - ./backend/sql/userlogin.csv:/docker-entrypoint-initdb.d/userlogin.csv

  # mqtt:
  #   image: eclipse-mosquitto
  #   container_name: esp32_mqtt
  #   restart: always
  #   ports: 
  #     - "1884:1884"
  #   volumes:
  #     - ./mosquitto/config:/mosquitto/config

  backend:
    build: ./backend
    container_name: esp32_backend
    restart: always
    ports:
      - "3000:3000"
    # depends_on:
      # - mqtt
      # - postgres
    environment:
      DB_HOST: 192.168.10.27
      DB_PORT: 1433
      DB_USER: sa
      DB_PASSWORD: Marcello21
      DB_NAME: thirdparty
      # MQTT_BROKER_URL : mqtt://mqtt:1884
    volumes:
      # - C:/Users/iotal/Documents/SystemGate/backend/uploads:/usr/src/app/uploads
      # - uploads_data:/usr/src/app/uploads
      - C:/Users/iotal/Documents/SystemGate/backend/uploads:/app/uploads

  # frontend:
  #   build:
  #     context: ./frontend

  #     dockerfile: Dockerfile
  #   container_name: esp32_frontend
  #   restart: always
  #   ports:
  #     - "8080:80"
  #   depends_on:
  #     - backend

volumes:
  pgdata:
  uploads_data:
